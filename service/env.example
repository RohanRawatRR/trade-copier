# ============================================================
# TRADE COPIER CONFIGURATION
# ============================================================
# Copy this file to .env and fill in your actual values
# DO NOT commit .env to version control!

# ============================================================
# MASTER ACCOUNT CREDENTIALS
# ============================================================
# Master account credentials are now stored in the database.
# Configure them via the Next.js API: POST /api/master
# 
# Legacy: If you need to migrate from environment variables,
# you can temporarily set these, but they will be ignored
# once the master account exists in the database.
# MASTER_API_KEY=your_master_api_key_here
# MASTER_SECRET_KEY=your_master_secret_key_here
# MASTER_ACCOUNT_ID=your_master_account_id_here

# ============================================================
# DATABASE CONFIGURATION
# ============================================================
# PostgreSQL (recommended for production - supports 1000+ clients)
DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/trade_copier

# SQLite (for development/small deployments - good for up to 1000 clients)
# DATABASE_URL=sqlite+aiosqlite:///./trade_copier.db

# MongoDB (alternative, requires motor driver)
# DATABASE_URL=mongodb://localhost:27017/trade_copier

# ============================================================
# ENCRYPTION CONFIGURATION
# ============================================================
# Generate a new key with:
# python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# 
# ⚠️  CRITICAL: Keep this key secure! If lost, you cannot decrypt stored credentials.
ENCRYPTION_KEY=your_fernet_encryption_key_here

# ============================================================
# ALPACA API CONFIGURATION
# ============================================================
# Paper Trading (for testing - RECOMMENDED to start with this)
ALPACA_BASE_URL=https://paper-api.alpaca.markets
ALPACA_DATA_URL=https://data.alpaca.markets
USE_PAPER_TRADING=true

# Live Trading (⚠️  REAL MONEY - only use after thorough testing!)
# ALPACA_BASE_URL=https://api.alpaca.markets
# ALPACA_DATA_URL=https://data.alpaca.markets
# USE_PAPER_TRADING=false

# ============================================================
# PERFORMANCE SETTINGS
# ============================================================
# Maximum number of orders to submit concurrently
# Higher = faster but more API load
# Recommended: 500 for t3.medium, 1000 for t3.large
MAX_CONCURRENT_ORDERS=500

# Number of orders per batch before rate limit delay
# Lower = more conservative, Higher = faster but riskier
ORDER_BATCH_SIZE=100

# Delay between batches in seconds (for rate limit protection)
# Alpaca limit: 200 requests/minute
# 0.05 = 50ms delay = ~1200 requests/minute (with batching)
RATE_LIMIT_DELAY=0.05

# WebSocket reconnection delay in seconds
# How long to wait before attempting to reconnect after disconnect
WEBSOCKET_RECONNECT_DELAY=5

# Master credential hot-reload check interval in seconds
# How often to check for master account credential changes (5-300 seconds)
# Lower = faster detection but more database queries
# Default: 30 seconds
MASTER_CREDENTIAL_CHECK_INTERVAL=30

# ============================================================
# SCALING CONFIGURATION
# ============================================================
# Uses equity-based scaling (proportional to account balance)
# Formula: client_qty = master_qty × (client_equity / master_equity)
# If master uses 90% of equity, client uses 90% of equity

# Minimum order size in shares
# Orders smaller than this will be skipped
MIN_ORDER_SIZE=0.01

# Minimum dollar value for fractional trades
# Alpaca requires at least $1.00 for fractional/notional orders
MIN_NOTIONAL_VALUE=1.00

# Allow fractional shares (true/false)
# Set to true for stocks that support fractional trading
ALLOW_FRACTIONAL_SHARES=true

# ============================================================
# CIRCUIT BREAKER SETTINGS
# ============================================================
# Number of consecutive failures before opening circuit breaker
# Higher = more tolerant of failures, Lower = fail fast
FAILURE_THRESHOLD=5

# Time in seconds before attempting to close circuit breaker
# After this time, circuit enters "half-open" state for testing
CIRCUIT_TIMEOUT=300

# ============================================================
# MONITORING & LOGGING
# ============================================================
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Use INFO for production, DEBUG for troubleshooting
LOG_LEVEL=INFO

# Enable structured JSON logging (recommended for production)
# Set to false for human-readable console output during development
ENABLE_STRUCTURED_LOGGING=true

# Enable Prometheus metrics endpoint
ENABLE_METRICS=true

# Port for Prometheus metrics (if ENABLE_METRICS=true)
METRICS_PORT=9090

# ============================================================
# SLACK NOTIFICATIONS (OPTIONAL)
# ============================================================
# Create a Slack webhook at: https://api.slack.com/messaging/webhooks
SLACK_WEBHOOK_URL=
SLACK_ALERT_CHANNEL=#trading-alerts
ENABLE_SLACK_ALERTS=false

# ============================================================
# EMAIL NOTIFICATIONS (OPTIONAL)
# ============================================================
# SMTP configuration for email alerts
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
ALERT_EMAIL_TO=
ENABLE_EMAIL_ALERTS=false

# ============================================================
# LATENCY THRESHOLDS
# ============================================================
# Warning threshold in milliseconds
# Alerts sent when replication takes longer than this
LATENCY_WARNING_THRESHOLD=150

# Critical threshold in milliseconds
# Higher priority alerts sent when replication takes longer than this
LATENCY_CRITICAL_THRESHOLD=200

# ============================================================
# RETRY CONFIGURATION
# ============================================================
# Maximum number of retry attempts for failed orders
# 0 = no retries, 3 = up to 3 retries (4 total attempts)
MAX_RETRY_ATTEMPTS=3

# Initial retry delay in seconds
# First retry happens after this delay
RETRY_INITIAL_DELAY=1.0

# Maximum retry delay in seconds
# Delays won't grow beyond this (exponential backoff cap)
RETRY_MAX_DELAY=10.0

# Exponential base for backoff calculation
# 2 = delays double each time (1s, 2s, 4s, 8s...)
RETRY_EXPONENTIAL_BASE=2

# Add random jitter to retry delays (true/false)
# Prevents "thundering herd" problem when many requests fail simultaneously
RETRY_JITTER=true

# ============================================================
# NOTES
# ============================================================
# 
# Security Best Practices:
# 1. Never commit the .env file to version control
# 2. Use strong encryption keys (generate with provided command)
# 3. Rotate API keys regularly
# 4. Use AWS Secrets Manager or similar in production
# 5. Restrict file permissions: chmod 600 .env
#
# Performance Tuning:
# 1. Start with conservative settings (500 concurrent, 100 batch)
# 2. Monitor latency and adjust MAX_CONCURRENT_ORDERS
# 3. Increase RATE_LIMIT_DELAY if hitting Alpaca rate limits
# 4. Use equity_based scaling for fairest distribution
#
# Testing Strategy:
# 1. Always start with USE_PAPER_TRADING=true
# 2. Test with 5-10 clients first
# 3. Verify latency is acceptable
# 4. Gradually scale to full client count
# 5. Monitor for 1 week before production rollout
#
# Support:
# - Documentation: See README.md, ARCHITECTURE.md, DEPLOYMENT.md
# - Quick Start: See QUICKSTART.md
# - Testing: See TESTING.md
#
# ============================================================

